[supervisord]
nodaemon=true
user=root

[program:redis]
command=/usr/bin/redis-server
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:check_internet]
; Run once per minute (no busy looping)
command=/bin/bash -lc 'while true; do /app/check_internet.sh || true; sleep 60; done'
directory=/app
autostart=true
autorestart=true
startsecs=0
startretries=3
exitcodes=0
stopsignal=TERM
killasgroup=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stopasgroup=true

[program:dashboard]
; Serve Dash with Gunicorn (production)
command=/usr/local/bin/gunicorn internet_status_dashboard:server --workers 1 --threads 2 --bind 0.0.0.0:8050 --timeout 60
directory=/app
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
